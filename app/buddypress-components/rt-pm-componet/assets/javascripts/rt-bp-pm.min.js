jQuery(document).ready(function(e){function a(t,n){e(t).addClass("error");if(e(t).next().length>0){if(e(t).next().hasClass("error")){e(t).next().html(n)}else{e(t).after("<small class='error'>"+n+"</small>")}}else{e(t).after("<small class='error'>"+n+"</small>")}}function f(t){e(t).removeClass("error");if(e(t).next().length>0){if(e(t).next().hasClass("error")){e(t).next().remove()}}}function h(e,t){var n=e.type=="image"?e.url:e.icon;return"<li tabindex='0' role='checkbox' aria-label='6_webp' aria-checked='false' class='attachment save-ready document-attachment'>"+"<div class='attachment-preview js--select-attachment type-image subtype-png landscape'>"+"<div class='thumbnail'>"+"<div class='centered'>"+"<img src='"+n+"' draggable='false' alt=''>"+"</div>"+"</div>"+"<div class='filename'>"+"<div>"+e.title+"</div>"+"</div>"+"</div>"+"<a class='check document-check'  title='Deselect' tabindex='-1' data-document-id='"+t.attachment_id+"'><div class='media-modal-icon'></div></a>"+"</li>"}e(document).foundation();var t=e("<div class='loading-overlay'><i class='loader-icon'></i></div>");e.ajaxSetup({beforeSend:function(n,r){if(r.data.indexOf("heartbeat")===-1&&r.data.indexOf("closed-postboxes")===-1&&r.data.indexOf("meta-box-order")===-1){e("body").append(t)}},complete:function(t,n){e("body").find(".loading-overlay").remove()}});try{if(arr_project_member_user!=undefined){jQuery("#project_member_user_ac").autocomplete({source:function(t,n){var r=e.ui.autocomplete.escapeRegex(t.term),i=new RegExp("^"+r,"i"),s=e.grep(arr_project_member_user,function(e){return i.test(e.label||e.value||e)}),o=new RegExp(r,"i"),u=e.grep(arr_project_member_user,function(t){return e.inArray(t,s)<0&&o.test(t.label||t.value||t)});n(s.concat(u))},focus:function(e,t){},select:function(e,t){if(jQuery("#project-member-auth-"+t.item.id).length<1){jQuery("#divProjectMemberList").append("<li id='project-member-auth-"+t.item.id+"' class='contact-list' ><div class='row'><div class='small-2 column'>"+t.item.imghtml+"</div><div class='small-9 columns'><a target='_blank' href='"+t.item.user_edit_link+"'>"+t.item.label+"</a></div><div class='small-1 columns'><a href='#removeProjectMember' class='right'><i class='foundicon-remove'></i></a><input type='hidden' name='post[project_member][]' value='"+t.item.id+"' /></div></div></li>")}jQuery("#project_member_user_ac").val("");return false}}).data("ui-autocomplete")._renderItem=function(t,n){return e("<li></li>").data("ui-autocomplete-item",n).append("<a class='ac-project-member-selected'>"+n.imghtml+"&nbsp;"+n.label+"</a>").appendTo(t)};jQuery(document).on("click","a[href=#removeProjectMember]",function(t){t.preventDefault();e(this).parent().parent().parent().remove()})}}catch(n){}try{if(arr_project_organization!=undefined){jQuery("#project_org_search_account").autocomplete({source:function(t,n){var r=e.ui.autocomplete.escapeRegex(t.term),i=new RegExp("^"+r,"i"),s=e.grep(arr_project_organization,function(e){return i.test(e.label||e.value||e)}),o=new RegExp(r,"i"),u=e.grep(arr_project_organization,function(t){return e.inArray(t,s)<0&&o.test(t.label||t.value||t)});n(s.concat(u))},focus:function(e,t){},select:function(e,t){if(jQuery("#project-org-auth-"+t.item.id).length<1){jQuery("#divProjectAccountsList").append("<li id='project-org-auth-"+t.item.id+"' class='contact-list' ><div class='row'><div class='column small-2'>"+t.item.imghtml+"</div><div class='column small-9'><a target='_blank' href='"+t.item.user_edit_link+"'>"+t.item.label+"</a></div><div class='column small-1'><a href='#removeProjectOrganization' class='right'><i class='foundicon-remove'></i></a><input type='hidden' name='post[project_organization][]' value='"+t.item.id+"' /></div></div></li>")}jQuery("#project_org_search_account").val("");return false}}).data("ui-autocomplete")._renderItem=function(t,n){return e("<li></li>").data("ui-autocomplete-item",n).append("<a class='ac-project-client =-selected'>"+n.imghtml+"&nbsp;"+n.label+"</a>").appendTo(t)};jQuery(document).on("click","a[href=#removeProjectOrganization]",function(t){t.preventDefault();e(this).parent().parent().parent().remove()})}}catch(n){}try{if(arr_project_client_user!=undefined){jQuery("#project_client_user_ac").autocomplete({source:function(t,n){var r=e.ui.autocomplete.escapeRegex(t.term),s=new RegExp("^"+r,"i"),o=e.grep(arr_project_client_user,function(t){if(e("input[name*='post[project_organization]']").length>0){org=new Array;e.each(e("input[name*='post[project_organization]']"),function(t,n){org.push(parseInt(e(n).val()))});flag=false;for(i=0;i<org.length;i++){if(!e.inArray(org[i],t.organization)){flag=true}}if(!flag){return false}}return s.test(t.label||t.value||t)}),u=new RegExp(r,"i"),a=e.grep(arr_project_client_user,function(t){if(e("input[name*='post[project_organization]']").length>0){org=new Array;e.each(e("input[name*='post[project_organization]']"),function(t,n){org.push(parseInt(e(n).val()))});flag=false;for(i=0;i<org.length;i++){if(!e.inArray(org[i],t.organization)){flag=true}}if(!flag){return false}}return e.inArray(t,o)<0&&u.test(t.label||t.value||t)});n(o.concat(a))},focus:function(e,t){},select:function(e,t){if(jQuery("#project-client-auth-"+t.item.id).length<1){jQuery("#divProjectClientList").append("<li id='project-client-auth-"+t.item.id+"' class='contact-list' ><div class='row'><div class='small-2 column'>"+t.item.imghtml+"</div><div class='small-9 columns'><a target='_blank' href='"+t.item.user_edit_link+"'>"+t.item.label+"</a></div><div class='small-1 columns'><a href='#removeProjectClient' class='right'><i class='foundicon-remove'></i></a><input type='hidden' name='post[project_client][]' value='"+t.item.id+"' /></div></div></li>")}jQuery("#project_client_user_ac").val("");return false}}).data("ui-autocomplete")._renderItem=function(t,n){return e("<li></li>").data("ui-autocomplete-item",n).append("<a class='ac-project-client =-selected'>"+n.imghtml+"&nbsp;"+n.label+"</a>").appendTo(t)};jQuery(document).on("click","a[href=#removeProjectClient]",function(t){t.preventDefault();e(this).parent().parent().parent().remove()})}}catch(n){}if(e(".datetimepicker").length>0){e(".datetimepicker").datetimepicker({dateFormat:"M d, yy",timeFormat:"hh:mm TT",onClose:function(t,n){if(e(this).hasClass("moment-from-now")){var r=e(this).attr("title");if(t!=""&&moment(t).isValid()){e(this).val(moment(new Date(t)).fromNow());e(this).attr("title",t);if(e(this).next().length>0){e(this).next().val(t)}}else if(r!=""){e(this).val(moment(new Date(r)).fromNow());e(this).attr("title",r);if(e(this).next().length>0){e(this).next().val(t)}}}}})}e(document).on("click",".moment-from-now",function(t){var n=e(this).attr("title");if(n!=""){e(this).datepicker("setDate",new Date(e(this).attr("title")))}});e(".datepicker-toggle").click(function(t){e(this).parent("div").prev().find(".hasDatepicker").click();e(this).parent("div").prev().find(".hasDatepicker").datepicker("show")});e(".moment-from-now").each(function(){if(e(this).is("input[type='text']")&&e(this).val()!="")e(this).val(moment(new Date(e(this).attr("title"))).fromNow());else if(e(this).is(".comment-date"))e(this).html(moment(new Date(e(this).attr("title"))).fromNow());else e(this).html(moment(new Date(e(this).html())).fromNow())});var r=new Date(e("#modification_date").attr("title"));var s=new Date;var o=s.getTimezoneOffset();var u=new Date(r.getTime()+o*6e4);e("#modification_date").val(moment(u).fromNow());e("#button-trash").click(function(){var t=confirm("Are you sure you want to move this project to trash?");if(t!=true){return false}window.location=e(this).data("href");return false});e("a.close").on("click",function(t){t.preventDefault();e(this).parent().remove()});e("#form-add-post").submit(function(t){try{var n=e("#new_"+e(this).data("posttype")+"_title");if(e(n).val().trim()==""){a(n,"Please Enter the Title");return false}var r=e("#create_"+e(this).data("posttype")+"_date");if(e(this).data("posttype")=="rt_task"){var i=e("#due_"+e(this).data("posttype")+"_date");if(e(i).datepicker("getDate")<=e(r).datepicker("getDate")){a(i,"Please Enter valid Date");return false}f(i)}else if(e(this).data("posttype")=="rt_time_entry"){var s=new Date;if(s<e(r).datepicker("getDate")){a(r,"Please Enter valid Date");return false}f(r)}f(n)}catch(t){console.log(t);return false}});jQuery(document).on("click",".rtpm_delete_attachment",function(e){e.preventDefault();jQuery(this).parents("tr").remove()});var l;jQuery("#add_pm_attachment").on("click",function(e){e.preventDefault();if(l){l.open();return}l=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),searchable:true,button:{text:"Attach Selected Files"},multiple:true});l.on("select",function(){var e=l.state().get("selection");var t="";e.map(function(e){e=e.toJSON();t='<tr class="large-12 mobile-large-3 attachment-item" data-attachment-id="'+e.id+'">';t+='<td scope="column"><img height="20px" width="20px" src="'+e.icon+'"'+e.filename+'" /></td>';t+='<td scope="column"><a target="_blank" href="'+e.url+'"> '+e.filename+"</a></td>";t+='<td scope="column"><span>&nbsp;&nbsp;&nbsp;</span></td>';t+='<td scope="column"><a href="#" class="rtpm_delete_attachment right">x</a>';t+='<input type="hidden" name="attachment[]" value="'+e.id+'" /></td></tr>';jQuery("#attachment-container .scroll-height table").append(t)})});l.open()});jQuery("#add_project_attachment").on("click",function(t){t.preventDefault();var n=e(this).data("projectid");if(l){l.open();return}l=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),searchable:true,button:{text:"Attach Selected Files"},multiple:true});l.on("select",function(){var t=l.state().get("selection");var r="";t.map(function(t){t=t.toJSON();r='<div class="large-12 mobile-large-3 columns attachment-item" data-attachment-id="'+t.id+'">';r+='<a target="_blank" href="'+t.url+'"><img height="20px" width="20px" src="'+t.icon+'" > '+t.filename+"</a>";r+='<a href="#" data-attachmentid="'+t.id+'" class="rtpm_delete_project_attachment right">x</a>';r+='<input type="hidden" name="attachment[]" value="'+t.id+'" /></div>';jQuery("#attachment-container .scroll-height").append(r);e.ajax({url:ajaxurl,dataType:"json",type:"post",data:{action:"rtpm_add_attachement",project_id:n,attachment_id:t.id},success:function(e){}})})});l.open()});jQuery(document).on("click",".rtpm_delete_project_attachment",function(t){t.preventDefault();var n=e("#add_project_attachment").data("projectid");var r=e(this).data("attachmentid");var i=confirm("Are you sure you want to remove this Attachment?");if(i!=true){return false}e.ajax({url:ajaxurl,type:"post",data:{action:"rtpm_remove_attachment",project_id:n,attachment_id:r},success:function(t){e("#attachment-error").removeClass()}});jQuery(this).parent().parent().remove()});e(document).on("click",".add-task",function(t){e("#div-add-task").reveal({opened:function(){}})});e(document).on("click",".add-time-entry",function(t){e("#div-add-time-entry").reveal({opened:function(){}})});e(document).on("click",".add-external-link",function(t){e("#div-add-external-link").reveal({opened:function(){}})});e(".deletepostlink").click(function(){var e=confirm("Are you sure you want to delete this?");if(e!=true){return false}});e("#rtpm_post_status").on("change",function(t){if(e(this).val()=="closed"){e("#rtpm_closing_reason_wrapper").show()}else{e("#rtpm_closing_reason_wrapper").hide()}});e("span.rtpm_readmore").readmore({speed:75,maxHeight:20,sectionCSS:"display: inline-block;"});e("#top-button-trash").click(function(){var t=confirm("Are you sure you want to move this project to trash?");if(t!=true){return false}window.location=e(this).data("href");return false});e("#button-archive").click(function(){var t=confirm("Are you sure you want to move this project to archive?");if(t!=true){return false}window.location=e(this).data("href");return false});e("#button-unarchive").click(function(){var t=confirm("Are you sure you want to move this project to unarchive?");if(t!=true){return false}window.location=e(this).data("href");return false});e("#top-button-archive").click(function(){var t=confirm("Are you sure you want to move this project to archive?");if(t!=true){return false}window.location=e(this).data("href");return false});e("#top-button-unarchive").click(function(){var t=confirm("Are you sure you want to move this project to unarchive?");if(t!=true){return false}window.location=e(this).data("href");return false});e(".add-task").click(function(){e(".add-task").text("Update Task")});e(".add-task").click(function(){e(".add-task").text("Update Task")});e(".add-time-entry").click(function(){e(".add-time-entry").text("Update Time Entry")});e(document).on("click",".removeMeta",function(){e(this).parent().parent().remove()});e("#add_ex_file_title").change(function(){var t=e("#add_ex_file_title").val();e("#add_modal_title").val(t)});e("#add_ex_file_link").change(function(){var t=e("#add_ex_file_link").val();e("#add_modal_link").val(t)});var c;e("#upload_image").on("click",function(t){t.preventDefault();if(c){c.open();return}c=wp.media.frames.file_frame=wp.media({title:"Choose Documents",button:{text:"Choose Documents"},multiple:true});c.on("select",function(){attachments=c.state().get("selection").toJSON();filenames=[];e.each(attachments,function(t,n){var r={attachment_id:n.id,action:"rtbiz_add_new_documents",post_id:e("#post-id").val(),filename:n.url};console.log(r);e.post(ajaxurl,r,function(t){e("#attachment-document").prepend(h(n,t))},"json")})});c.open()});e("li.document-attachment").live("click",function(){var t=e(this).attr("aria-checked");if(t=="false"){e("#attachment-document>li.document-attachment").attr("aria-checked","false");e("#attachment-document>li.document-attachment").removeClass(" details selected");e(this).attr("aria-checked","true");e(this).addClass(" details selected");var n=e(this).find("a").data("document-id");e(".actions").data("attachment-id",n);var r={action:"rtattachment_metadata",attachment_id:n};e.post(ajaxurl,r,function(t){e(".filetype").html("<strong>File type: </strong> "+t.post_mime_type);e(".uploaded").html(" <strong>Uploaded on: </strong>"+t.post_modified);e("#fileurl").val(t.guid);e("#filetitle").val(t.post_title);e("#filecaption").val(t.post_excerpt);e("#filedescription").val(t.post_content);e(".details>a").attr("href",t.guid)},"json")}else{e(".filetype").html("");e(".uploaded").html("");e("#fileurl").val("");e("#filetitle").val("");e("#filecaption").val("");e("#filedescription").val("");e(".details>a").attr("href","#");e(this).attr("aria-checked","false");e(this).removeClass(" details selected")}});e("#save-attachment").on("click",function(){var t=e(".actions").data("attachment-id");var n={action:"rtattachment_save_data",ID:t,post_title:e("#filetitle").val(),post_excerpt:e("#filecaption").val(),post_content:e("#filedescription").val()};e.post(ajaxurl,n,function(t){if(t>0){$element=e("#attachment-document>li.document-attachment.details.selected");$element.find(".filetitle").html(e("#filetitle").val())}})});e("#delete-attachment").live("click",function(){var t=e(".actions").data("attachment-id");var n={action:"rtbiz_remove_document",attachment_id:t};e.post(ajaxurl,n,function(t){$element=e("#attachment-document>li.document-attachment.details.selected");$element.remove();e(".filetype").html("");e(".uploaded").html("");e("#fileurl").val("");e("#filetitle").val("");e("#filecaption").val("");e("#filedescription").val("");e(".details>a").attr("href","#")})});e("a.document-check").live("click",function(t){t.preventDefault();$element=e(this).parent();var n={action:"rtbiz_remove_document",attachment_id:e(this).data("document-id")};e.post(ajaxurl,n,function(e){$element.remove()})})})